<!--
  Suricata rules for Wazuh integration
  Place in: /opt/wazuh-docker/config/wazuh_cluster/custom/rules/
-->

<group name="suricata,ids,intrusion_detection">
  
  <!-- Basic Suricata Events -->
  <rule id="200000" level="0">
    <decoded_as>suricata-eve</decoded_as>
    <description>Suricata messages grouped</description>
  </rule>
  
  <!-- Alert Rules -->
  <rule id="200001" level="5">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-alert</decoded_as>
    <description>Suricata: Alert - $(signature)</description>
    <group>intrusion_detection,alert</group>
  </rule>

  <!-- Critical Alerts -->
  <rule id="200002" level="12">
    <if_sid>200001</if_sid>
    <field name="severity">1</field>
    <description>Suricata: High priority alert - $(signature)</description>
    <group>intrusion_detection,high_priority</group>
  </rule>

  <rule id="200003" level="10">
    <if_sid>200001</if_sid>
    <field name="severity">2</field>
    <description>Suricata: Medium priority alert - $(signature)</description>
    <group>intrusion_detection,medium_priority</group>
  </rule>

  <rule id="200004" level="7">
    <if_sid>200001</if_sid>
    <field name="severity">3</field>
    <description>Suricata: Low priority alert - $(signature)</description>
    <group>intrusion_detection,low_priority</group>
  </rule>

  <!-- Category-based Rules -->
  <rule id="200010" level="10">
    <if_sid>200001</if_sid>
    <field name="category">trojan-activity</field>
    <description>Suricata: Trojan activity detected - $(signature)</description>
    <group>intrusion_detection,malware,trojan</group>
  </rule>

  <rule id="200011" level="10">
    <if_sid>200001</if_sid>
    <field name="category">web-application-attack</field>
    <description>Suricata: Web application attack - $(signature)</description>
    <group>intrusion_detection,web_attack</group>
  </rule>

  <rule id="200012" level="9">
    <if_sid>200001</if_sid>
    <field name="category">attempted-admin</field>
    <description>Suricata: Administrator privilege gain attempt - $(signature)</description>
    <group>intrusion_detection,privilege_escalation</group>
  </rule>

  <rule id="200013" level="11">
    <if_sid>200001</if_sid>
    <field name="category">successful-admin</field>
    <description>Suricata: Successful administrator privilege gain - $(signature)</description>
    <group>intrusion_detection,privilege_escalation,successful</group>
  </rule>

  <rule id="200014" level="8">
    <if_sid>200001</if_sid>
    <field name="category">denial-of-service</field>
    <description>Suricata: Denial of Service attack detected - $(signature)</description>
    <group>intrusion_detection,dos</group>
  </rule>

  <rule id="200015" level="9">
    <if_sid>200001</if_sid>
    <field name="category">credential-theft</field>
    <description>Suricata: Credential theft attempt - $(signature)</description>
    <group>intrusion_detection,credential_theft</group>
  </rule>

  <rule id="200016" level="8">
    <if_sid>200001</if_sid>
    <field name="category">coin-mining</field>
    <description>Suricata: Cryptocurrency mining activity - $(signature)</description>
    <group>intrusion_detection,crypto_mining</group>
  </rule>

  <rule id="200017" level="9">
    <if_sid>200001</if_sid>
    <field name="category">command_control</field>
    <description>Suricata: Command and Control communication - $(signature)</description>
    <group>intrusion_detection,c2</group>
  </rule>

  <!-- DNS Security Events -->
  <rule id="200020" level="5">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-dns</decoded_as>
    <description>Suricata: DNS query for $(dns_query)</description>
    <group>dns,network</group>
  </rule>

  <rule id="200021" level="8">
    <if_sid>200020</if_sid>
    <field name="dns_query">\.tk$|\.ml$|\.ga$|\.cf$</field>
    <description>Suricata: DNS query to suspicious TLD - $(dns_query)</description>
    <group>dns,suspicious_domain</group>
  </rule>

  <rule id="200022" level="9">
    <if_sid>200020</if_sid>
    <regex>malware|phishing|botnet|trojan</regex>
    <description>Suricata: DNS query to malicious domain - $(dns_query)</description>
    <group>dns,malware</group>
  </rule>

  <!-- HTTP Security Events -->
  <rule id="200030" level="5">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-http</decoded_as>
    <description>Suricata: HTTP request to $(hostname)$(url)</description>
    <group>web,http</group>
  </rule>

  <rule id="200031" level="8">
    <if_sid>200030</if_sid>
    <field name="http_status">^4\d\d$</field>
    <description>Suricata: HTTP client error $(http_status) - $(hostname)$(url)</description>
    <group>web,http,client_error</group>
  </rule>

  <rule id="200032" level="8">
    <if_sid>200030</if_sid>
    <field name="http_status">^5\d\d$</field>
    <description>Suricata: HTTP server error $(http_status) - $(hostname)$(url)</description>
    <group>web,http,server_error</group>
  </rule>

  <!-- TLS/SSL Events -->
  <rule id="200040" level="5">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-tls</decoded_as>
    <description>Suricata: TLS connection to $(tls_subject)</description>
    <group>ssl,tls</group>
  </rule>

  <rule id="200041" level="7">
    <if_sid>200040</if_sid>
    <field name="tls_version">SSLv3|TLSv1\.0</field>
    <description>Suricata: Insecure TLS version $(tls_version) used</description>
    <group>ssl,tls,weak_crypto</group>
  </rule>

  <!-- SSH Events -->
  <rule id="200050" level="5">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-ssh</decoded_as>
    <description>Suricata: SSH connection - client: $(ssh_client), server: $(ssh_server)</description>
    <group>ssh</group>
  </rule>

  <!-- File Transfer Events -->
  <rule id="200060" level="6">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-fileinfo</decoded_as>
    <description>Suricata: File transfer detected - $(filename) ($(filesize) bytes)</description>
    <group>files</group>
  </rule>

  <rule id="200061" level="9">
    <if_sid>200060</if_sid>
    <regex>\.exe$|\.scr$|\.bat$|\.com$|\.pif$</regex>
    <description>Suricata: Executable file transfer - $(filename)</description>
    <group>files,executable</group>
  </rule>

  <!-- Anomaly Detection -->
  <rule id="200070" level="7">
    <if_sid>200000</if_sid>
    <decoded_as>suricata-anomaly</decoded_as>
    <description>Suricata: Network anomaly detected - $(anomaly_type) in $(anomaly_layer)</description>
    <group>anomaly,network</group>
  </rule>

  <!-- Frequency-based Rules -->
  <rule id="200080" level="8" frequency="10" timeframe="300">
    <if_sid>200001</if_sid>
    <same_field>srcip</same_field>
    <description>Suricata: Multiple alerts from same source IP $(srcip)</description>
    <group>intrusion_detection,attack,multiple_alerts</group>
  </rule>

  <rule id="200081" level="8" frequency="5" timeframe="300">
    <if_sid>200030</if_sid>
    <same_field>srcip</same_field>
    <field name="http_status">^4\d\d$</field>
    <description>Suricata: Multiple HTTP 4xx errors from $(srcip)</description>
    <group>web,http,scanning</group>
  </rule>

  <!-- Homelab-specific Rules -->
  <rule id="200100" level="10">
    <if_sid>200001</if_sid>
    <field name="signature_id">1000001|1000002|1000003</field>
    <description>Suricata: Homelab custom rule triggered - $(signature)</description>
    <group>homelab,custom_rules</group>
  </rule>

  <rule id="200101" level="11">
    <if_sid>200001</if_sid>
    <field name="signature_id">1000040|1000041</field>
    <description>Suricata: Container security violation - $(signature)</description>
    <group>homelab,container_security</group>
  </rule>

  <rule id="200102" level="9">
    <if_sid>200001</if_sid>
    <field name="signature_id">1000050|1000051</field>
    <description>Suricata: Lateral movement detected - $(signature)</description>
    <group>homelab,lateral_movement</group>
  </rule>

  <rule id="200103" level="10">
    <if_sid>200001</if_sid>
    <field name="signature_id">1000060|1000061</field>
    <description>Suricata: Data exfiltration attempt - $(signature)</description>
    <group>homelab,data_exfiltration</group>
  </rule>

  <!-- Composite Rules for Advanced Threats -->
  <rule id="200200" level="13">
    <if_sid>200010,200017</if_sid>
    <same_field>srcip</same_field>
    <description>Suricata: APT-like behavior from $(srcip) - trojan + C2</description>
    <group>apt,advanced_threat</group>
  </rule>

  <rule id="200201" level="12">
    <if_sid>200011,200015</if_sid>
    <same_field>srcip</same_field>
    <description>Suricata: Web attack with credential theft from $(srcip)</description>
    <group>web_attack,credential_theft</group>
  </rule>

</group>